# 分類管理功能說明

## 功能概述

分類管理功能允許管理員在後台管理商品分類，包括新增、編輯、刪除分類，以及查看分類的詳細資訊。

## 功能特色

### 1. 分類列表
- 顯示所有分類的卡片式列表
- 每個分類顯示：名稱、描述、建立時間、更新時間
- 支援編輯和刪除操作

### 2. 新增分類
- 點擊「新增分類」按鈕開啟彈窗
- 填寫分類名稱（必填）和描述（可選）
- 自動檢查分類名稱是否重複
- 成功後顯示成功訊息並重新載入列表

### 3. 編輯分類
- 點擊分類卡片上的「編輯」按鈕
- 彈窗預填寫現有資料
- 支援修改分類名稱和描述
- 檢查新名稱是否與其他分類衝突

### 4. 刪除分類
- 點擊「刪除」按鈕顯示確認對話框
- 檢查分類是否被商品使用中
- 如果分類被使用，會顯示錯誤訊息並阻止刪除
- 確認後執行刪除操作

## 技術架構

### 資料庫結構
```typescript
interface Category {
  id: string
  name: string
  description?: string
  created_at: string
  updated_at: string
}
```

### API 端點

#### GET /api/categories
- 取得所有分類列表
- 回傳：`Category[]`

#### POST /api/categories
- 新增分類
- 請求體：`{ name: string, description?: string }`
- 回傳：新增的分類物件

#### PUT /api/categories/[id]
- 更新分類
- 請求體：`{ name: string, description?: string }`
- 回傳：`{ success: true }`

#### DELETE /api/categories/[id]
- 刪除分類
- 檢查分類是否被商品使用
- 回傳：`{ success: true }`

### 檔案結構
```
lib/db/
├── categories.ts          # 分類資料庫模組
└── database.ts           # 商品資料庫模組

app/api/categories/
├── route.ts              # 分類列表 API
└── [id]/route.ts        # 單一分類 API

app/admin/
└── categories/
    └── page.tsx         # 分類管理頁面

components/
└── admin-nav.tsx        # 管理導航組件
```

## 使用方式

### 1. 訪問分類管理
1. 登入管理後台（`/admin/login`）
2. 在導航欄點擊「分類管理」
3. 或直接訪問 `/admin/categories`

### 2. 新增分類
1. 點擊「新增分類」按鈕
2. 填寫分類名稱（必填）
3. 填寫分類描述（可選）
4. 點擊「新增」按鈕

### 3. 編輯分類
1. 在分類卡片上點擊「編輯」按鈕
2. 修改分類名稱或描述
3. 點擊「更新」按鈕

### 4. 刪除分類
1. 在分類卡片上點擊「刪除」按鈕
2. 在確認對話框中點擊「刪除」
3. 注意：如果分類被商品使用中，無法刪除

## 安全檢查

### 1. 登入狀態檢查
- 所有管理頁面都會檢查 `localStorage.adminLoggedIn`
- 未登入會自動跳轉到登入頁面

### 2. 資料驗證
- 分類名稱必填
- 檢查分類名稱重複
- 刪除前檢查分類是否被使用

### 3. 錯誤處理
- API 錯誤會顯示 toast 訊息
- 網路錯誤會顯示適當的錯誤訊息
- 表單驗證錯誤會阻止提交

## 預設分類

系統會自動建立以下預設分類：
- Home Decor（家居裝飾用品）
- Kitchenware（廚房用品）
- Lighting（照明設備）
- Office（辦公用品）
- Plants（植物相關）

## 與商品管理的整合

### 1. 商品新增/編輯
- 商品管理頁面的分類下拉選單會顯示所有可用分類
- 分類變更會即時反映在商品管理頁面

### 2. 分類刪除保護
- 如果分類被商品使用中，無法刪除
- 系統會顯示適當的錯誤訊息

## 開發注意事項

### 1. 資料一致性
- 分類刪除前必須檢查是否被商品使用
- 分類名稱變更會影響所有使用該分類的商品

### 2. 效能考量
- 分類列表使用卡片式佈局，適合中等數量的分類
- API 回應包含完整的分類資訊，減少額外的 API 呼叫

### 3. 使用者體驗
- 所有操作都有適當的載入狀態和錯誤處理
- 使用 toast 訊息提供即時回饋
- 確認對話框防止意外刪除

## 未來擴展

### 1. 可能的功能擴展
- 分類排序功能
- 分類圖示上傳
- 分類層級結構（父子分類）
- 分類統計資訊（商品數量等）

### 2. 技術改進
- 加入分頁功能處理大量分類
- 實作分類搜尋功能
- 加入分類匯入/匯出功能
- 實作分類快取機制

## 測試建議

### 1. 功能測試
- 測試新增、編輯、刪除分類
- 測試分類名稱重複檢查
- 測試刪除被使用的分類
- 測試登入狀態檢查

### 2. 整合測試
- 測試分類變更對商品管理的影響
- 測試分類 API 與商品 API 的整合
- 測試前端與後端的資料同步

### 3. 使用者體驗測試
- 測試各種錯誤情況的處理
- 測試載入狀態的顯示
- 測試響應式設計在不同裝置上的表現 